const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');
require('dotenv').config();

const app = express();
app.use(cors()); // Allows your mobile frontend to talk to this server
app.use(express.json());

// Athlete Schema
const athleteSchema = new mongoose.Schema({
    name: { type: String, required: true },
    sport: { type: String, default: 'Athletics' },
    event: String,
    performanceHistory: [{ date: { type: Date, default: Date.now }, value: Number }],
    personalBest: Number
});

const Athlete = mongoose.model('Athlete', athleteSchema);

// GET: Load all athletes for the dashboard
app.get('/api/athletes', async (req, res) => {
    try {
        const athletes = await Athlete.find();
        res.json(athletes);
    } catch (err) {
        res.status(500).json({ message: err.message });
    }
});

// POST: Save a new stopwatch time
app.post('/api/athletes/:id/record', async (req, res) => {
    const { value } = req.body;
    const athlete = await Athlete.findById(req.params.id);
    athlete.performanceHistory.push({ value });
    
    // Update Personal Best if the new time is lower (faster)
    if (!athlete.personalBest || value < athlete.personalBest) {
        athlete.personalBest = value;
    }
    await athlete.save();
    res.json(athlete);
});

const PORT = process.env.PORT || 5000;
mongoose.connect(process.env.MONGO_URI)
    .then(() => console.log("DB Connected"))
    .catch(err => console.log(err));


app.listen(PORT, () => console.log(`Server running on port ${PORT}`));

        <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports Performance Web-App</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="app-container">
        <nav class="navigation">
            <div class="logo">TRACK<span>PRO</span></div>
            <ul>
                <li class="active"><i>üìä</i> Dashboard</li>
                <li><i>üèÉ</i> Athletes</li>
                <li><i>‚è±Ô∏è</i> Timer</li>
            </ul>
        </nav>

        <main class="main-content">
            <header>
                <h1>Performance Dashboard</h1>
            </header>

            <section class="timer-section">
                <div class="timer-display" id="display">00:00.00</div>let startTime, elapsedTime = 0, timerInterval;

// Format time for the display
function timeToString(time) {
    let mm = Math.floor(time / 60000);
    let ss = Math.floor((time % 60000) / 1000);
    let ms = Math.floor((time % 1000) / 10);
    return `${mm.toString().padStart(2, "0")}:${ss.toString().padStart(2, "0")}.${ms.toString().padStart(2, "0")}`;
}

// Timer Controls
document.getElementById("startBtn").onclick = () => {
    startTime = Date.now() - elapsedTime;
    timerInterval = setInterval(() => {
        elapsedTime = Date.now() - startTime;
        document.getElementById("display").innerHTML = timeToString(elapsedTime);
    }, 10);
};

document.getElementById("stopBtn").onclick = () => clearInterval(timerInterval);
document.getElementById("resetBtn").onclick = () => {
    clearInterval(timerInterval);
    elapsedTime = 0;
    document.getElementById("display").innerHTML = "00:00.00";
};

// Athlete Data and Rendering
const athletes = [
    { id: 1, name: "Liam Johnson", event: "100m", history: [11.5, 11.2, 10.8, 10.9] },
    { id: 2, name: "Noah Williams", event: "200m", history: [23.1, 22.8, 22.5, 22.4] },
    { id: 3, name: "Emma Brown", event: "100m", history: [12.4, 12.1, 11.9, 11.8] }
];

athletes.forEach((athlete) => {
    const card = document.createElement('div');
    card.className = 'athlete-card';
    card.innerHTML = `
        <h3>${athlete.name}</h3>
        <p style="color:#38bdf8; font-size:0.8rem">${athlete.event}</p>
        <div style="height:180px; margin-top:1rem">
            <canvas id="chart-${athlete.id}"></canvas>
        </div>
        <button onclick="alert('Time Assigned')" style="width:100%; margin-top:1rem; padding:0.5rem; background:#334155; color:white; border:none; border-radius:5px">Save Current Time</button>
    `;
    document.getElementById('athleteGrid').appendChild(card);

    new Chart(document.getElementById(`chart-${athlete.id}`), {
        type: 'line',
        data: {
            labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4'],
            datasets: [{
                data: athlete.history,
                borderColor: '#38bdf8',
                backgroundColor: 'rgba(56, 189, 248, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { y: { grid: { color: '#334155' } }, x: { grid: { display: false } } }
        }
    });
});
                <div class="timer-controls">
                    <button id="startBtn" class="btn-start">Start</button>
                    <button id="stopBtn" class="btn-stop">Stop</button>
                    <button id="resetBtn" class="btn-reset">Reset</button>
                </div>
            </section>

            <div class="athlete-grid" id="athleteGrid">
                </div>
        </main>
    </div>
    <script src="script.js"></script>
</body>
</html>

